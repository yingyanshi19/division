<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿç‰©åˆ†é…æ•¸å­¸éŠæˆ²</title>
    <style>
        :root {
            --primary: #ff7675;
            --secondary: #74b9ff;
            --accent: #55efc4;
            --light: #fffdf9;
            --dark: #2d3436;
            --gray: #636e72;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            padding: 30px;
            margin: 20px 0;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .game-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .problem-section {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
        }
        
        .problem-text {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 20px;
        }
        
        .problem-equation {
            font-size: 2.2rem;
            color: var(--primary);
            background: white;
            padding: 15px 30px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }
        
        .problem-hint {
            color: var(--gray);
            font-size: 1rem;
        }
        
        .controls-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 768px) {
            .controls-section {
                grid-template-columns: 1fr;
            }
        }
        
        .control-panel {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 2px solid #f1f2f6;
        }
        
        .control-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--dark);
        }
        
        .slider-container {
            margin: 20px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .slider-value {
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }
        
        input[type=range] {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #dfe6e9, var(--primary));
            border-radius: 10px;
            outline: none;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary);
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
        }
        
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
        }
        
        #game-area {
            width: 100%;
            height: 600px;
            background: #f8f9fa;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            margin: 20px 0;
            border: 3px dashed #e9ecef;
            display: flex;
            flex-direction: column;
        }
        
        .food-area {
            flex: 1.2;
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-bottom: 3px dashed #dfe6e9;
        }
        
        .food-area-title {
            text-align: center;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .food-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 15px;
            padding: 15px;
            justify-items: center;
            align-items: center;
        }
        
        .plate-area {
            flex: 1.8;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .plate-area-title {
            text-align: center;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .plate-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 20px;
            padding: 15px;
            justify-items: center;
            align-items: start;
            min-height: 400px;
        }
        
        .food-item {
            font-size: 2.2rem;
            cursor: grab;
            transition: transform 0.2s, opacity 0.2s;
            user-select: none;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .food-item.dragging {
            cursor: grabbing;
            z-index: 100;
            transform: scale(1.3);
        }
        
        .food-item.in-plate {
            opacity: 1;
            transform: none;
            font-size: 1.8rem;
            width: 45px;
            height: 45px;
        }
        
        .plate {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border: 3px solid var(--secondary);
            width: 130px;
            height: 130px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .plate-icon {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }
        
        .plate-label {
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .plate-count {
            color: var(--primary);
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .plate-food-items {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            justify-content: center;
            margin-top: 5px;
            min-height: 30px;
            max-width: 100%;
        }
        
        .answer-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
        }
        
        .answer-form {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .answer-label {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--dark);
        }
        
        .answer-input-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .answer-input {
            font-size: 2rem;
            width: 120px;
            text-align: center;
            padding: 10px;
            border: 3px solid var(--secondary);
            border-radius: 12px;
            outline: none;
            transition: all 0.3s;
            font-weight: bold;
            color: var(--dark);
        }
        
        .answer-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 118, 117, 0.2);
        }
        
        .answer-unit {
            font-size: 1.5rem;
            color: var(--gray);
        }
        
        .buttons-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
            justify-content: center;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #ff5252;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 118, 117, 0.3);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #0984e3;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(116, 185, 255, 0.3);
        }
        
        .btn-success {
            background: var(--accent);
            color: var(--dark);
        }
        
        .btn-success:hover {
            background: #00b894;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(85, 239, 196, 0.3);
        }
        
        .feedback {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 0.3s;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feedback.correct {
            background: rgba(85, 239, 196, 0.2);
            color: #00b894;
            opacity: 1;
        }
        
        .feedback.incorrect {
            background: rgba(255, 118, 117, 0.2);
            color: #ff5252;
            opacity: 1;
        }
        
        .instructions {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .instructions h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
            color: var(--gray);
            line-height: 1.8;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .stats-section {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            color: var(--gray);
            margin-top: 5px;
        }
        
        .current-problem-info {
            background: #f0f7ff;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            border-left: 5px solid var(--secondary);
        }
        
        .current-problem-info h3 {
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .problem-details {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .problem-detail {
            background: white;
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .problem-detail-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .problem-detail-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .problem-equation {
                font-size: 1.8rem;
                padding: 12px 20px;
            }
            
            .btn {
                min-width: 100%;
            }
            
            #game-area {
                height: 700px;
            }
            
            .food-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(5, 1fr);
            }
            
            .plate-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }
            
            .plate {
                width: 110px;
                height: 110px;
                padding: 10px;
            }
            
            .food-item {
                width: 60px;
                height: 60px;
                font-size: 1.8rem;
            }
        }
        
        .empty-cell {
            width: 70px;
            height: 70px;
            opacity: 0.3;
            border: 2px dashed #dfe6e9;
            border-radius: 10px;
        }
        
        .empty-plate-cell {
            width: 130px;
            height: 130px;
            opacity: 0;
        }
        
        .scroll-hint {
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><span role="img" aria-label="é£Ÿç‰©">ğŸ½ï¸</span> é£Ÿç‰©åˆ†é…æ•¸å­¸éŠæˆ²</h1>
            <p class="subtitle">éš¨æ©Ÿç”Ÿæˆæ•¸å­¸å•é¡Œï¼Œæ‹–å‹•é£Ÿç‰©åˆ°ç›¤å­ä¸Šï¼Œé£Ÿç‰©æœƒå¾é£Ÿç‰©å€æ¶ˆå¤±ã€‚è¨ˆç®—æ¯å€‹ç›¤å­æ‡‰è©²æœ‰å¤šå°‘é£Ÿç‰©ä¸¦è¼¸å…¥ç­”æ¡ˆï¼</p>
        </header>
        
        <div class="game-section">
            <!-- ç•¶å‰å•é¡Œè³‡è¨Š -->
            <div class="current-problem-info">
                <h3><span role="img" aria-hidden="true">ğŸ¯</span> ç•¶å‰å•é¡Œè³‡è¨Š</h3>
                <div class="problem-details">
                    <div class="problem-detail">
                        <div class="problem-detail-value" id="problem-dividend">12</div>
                        <div class="problem-detail-label">é£Ÿç‰©ç¸½æ•¸</div>
                    </div>
                    <div class="problem-detail">
                        <div class="problem-detail-value" id="problem-divisor">4</div>
                        <div class="problem-detail-label">ç›¤å­æ•¸é‡</div>
                    </div>
                </div>
            </div>
            
            <!-- å•é¡Œé¡¯ç¤ºå€åŸŸ -->
            <div class="problem-section">
                <div class="problem-text">è«‹è§£æ±ºä»¥ä¸‹å•é¡Œï¼š</div>
                <div class="problem-equation" id="problem-equation"></div>
                <div class="problem-hint" id="problem-hint"></div>
            </div>
            
            <!-- æ§åˆ¶å€åŸŸ -->
            <div class="controls-section">
                <div class="control-panel">
                    <div class="control-title">
                        <span role="img" aria-label="é£Ÿç‰©">ğŸ•</span>
                        <span>ç·´ç¿’é£Ÿç‰©æ•¸é‡</span>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>é£Ÿç‰©ç¸½æ•¸ï¼š</span>
                            <span class="slider-value" id="food-count-value">12</span>
                        </div>
                        <input type="range" id="food-slider" min="2" max="20" value="12" step="1">
                    </div>
                    <p class="problem-hint">è‡ªç”±èª¿æ•´ç·´ç¿’ç”¨çš„é£Ÿç‰©æ•¸é‡ (æœ€å¤š20å€‹)</p>
                </div>
                
                <div class="control-panel">
                    <div class="control-title">
                        <span role="img" aria-label="ç›¤å­">ğŸ½ï¸</span>
                        <span>ç·´ç¿’ç›¤å­æ•¸é‡</span>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>ç›¤å­æ•¸é‡ï¼š</span>
                            <span class="slider-value" id="plate-count-value">4</span>
                        </div>
                        <input type="range" id="plate-slider" min="2" max="10" value="4" step="1">
                    </div>
                    <p class="problem-hint">è‡ªç”±èª¿æ•´ç·´ç¿’ç”¨çš„ç›¤å­æ•¸é‡ (2-10å€‹)</p>
                </div>
            </div>
            
            <!-- çµ±è¨ˆå€åŸŸ -->
            <div class="stats-section">
                <div class="stat-box">
                    <div class="stat-value" id="total-food">12</div>
                    <div class="stat-label">ç·´ç¿’é£Ÿç‰©ç¸½æ•¸</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="total-plates">4</div>
                    <div class="stat-label">ç·´ç¿’ç›¤å­æ•¸é‡</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="remaining-food">12</div>
                    <div class="stat-label">å‰©é¤˜é£Ÿç‰©</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="food-on-plates">0</div>
                    <div class="stat-label">å·²åˆ†é…é£Ÿç‰©</div>
                </div>
            </div>
            
            <!-- éŠæˆ²å€åŸŸ -->
            <div id="game-area">
                <!-- é£Ÿç‰©å€åŸŸ -->
                <div class="food-area">
                    <div class="food-area-title">é£Ÿç‰©å€ (æ‹–å‹•é£Ÿç‰©åˆ°ç›¤å­ä¸Š)</div>
                    <div class="food-grid" id="food-grid">
                        <!-- é£Ÿç‰©å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
                
                <!-- ç›¤å­å€åŸŸ -->
                <div class="plate-area">
                    <div class="plate-area-title">ç›¤å­å€ (å°‡é£Ÿç‰©æ‹–åˆ°é€™è£¡)</div>
                    <div class="plate-grid" id="plate-grid">
                        <!-- ç›¤å­å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                    <div class="scroll-hint">å¦‚æœç›¤å­å¤ªå¤šçœ‹ä¸è¦‹ï¼Œå¯ä»¥å‘ä¸‹æ»¾å‹•</div>
                </div>
            </div>
            
            <!-- ç­”æ¡ˆè¼¸å…¥å€åŸŸ -->
            <div class="answer-section">
                <div class="answer-form">
                    <div class="answer-label">ä½ çš„ç­”æ¡ˆï¼š</div>
                    <div class="answer-input-container">
                        <span>æ¯å€‹ç›¤å­æœ‰</span>
                        <input type="number" class="answer-input" id="answer-input" min="1" max="20" step="1" placeholder="?">
                        <span class="answer-unit">å€‹é£Ÿç‰©</span>
                    </div>
                </div>
            </div>
            
            <!-- åé¥‹å€åŸŸ -->
            <div class="feedback" id="feedback"></div>
            
            <!-- æŒ‰éˆ•å€åŸŸ -->
            <div class="buttons-section">
                <button class="btn btn-primary" id="check-btn">
                    <span role="img" aria-hidden="true">âœ…</span> æª¢æŸ¥ç­”æ¡ˆ
                </button>
                <button class="btn btn-secondary" id="reset-btn">
                    <span role="img" aria-hidden="true">ğŸ”„</span> é‡æ–°é–‹å§‹
                </button>
                <button class="btn btn-success" id="new-problem-btn">
                    <span role="img" aria-hidden="true">ğŸ¯</span> æ–°å•é¡Œ
                </button>
            </div>
            
            <!-- èªªæ˜å€åŸŸ -->
            <div class="instructions">
                <h3><span role="img" aria-hidden="true">ğŸ“š</span> éŠæˆ²èªªæ˜</h3>
                <ul>
                    <li><strong>æ­¥é©Ÿ1ï¼š</strong> éš¨æ©Ÿç”Ÿæˆä¸€å€‹æ•¸å­¸å•é¡Œï¼ˆä¸Šæ–¹è—è‰²å€åŸŸï¼‰</li>
                    <li><strong>æ­¥é©Ÿ2ï¼š</strong> è‡ªç”±èª¿æ•´é£Ÿç‰©å’Œç›¤å­çš„æ•¸é‡é€²è¡Œç·´ç¿’ï¼ˆæ»‘ç«¿å€åŸŸï¼‰</li>
                    <li><strong>æ­¥é©Ÿ3ï¼š</strong> å¾é£Ÿç‰©å€æ‹–å‹•é£Ÿç‰©åˆ°ç›¤å­ä¸Šï¼ˆé£Ÿç‰©æœƒå¾é£Ÿç‰©å€æ¶ˆå¤±ï¼‰</li>
                    <li><strong>æ­¥é©Ÿ4ï¼š</strong> æ ¹æ“šéš¨æ©Ÿå•é¡Œè¨ˆç®—æ¯å€‹ç›¤å­æ‡‰è©²æœ‰å¤šå°‘é£Ÿç‰©</li>
                    <li><strong>æ­¥é©Ÿ5ï¼š</strong> åœ¨è¼¸å…¥æ¡†ä¸­è¼¸å…¥ä½ çš„ç­”æ¡ˆ</li>
                    <li><strong>æ­¥é©Ÿ6ï¼š</strong> é»æ“Šã€Œæª¢æŸ¥ç­”æ¡ˆã€æŸ¥çœ‹æ˜¯å¦æ­£ç¢º</li>
                    <li><strong>æ³¨æ„ï¼š</strong> å¦‚æœç­”æ¡ˆéŒ¯èª¤ï¼Œè«‹é‡æ–°æ€è€ƒä¸¦å†è©¦ä¸€æ¬¡ï¼</li>
                    <li><strong>é‡è¦ï¼š</strong> é£Ÿç‰©æ‹–åˆ°ç›¤å­å¾Œæœƒå¾é£Ÿç‰©å€æ¶ˆå¤±ï¼Œä»£è¡¨å·²è¢«åˆ†é…ï¼</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹è®Šæ•¸
        let currentProblem = null;
        let totalFood = 12;  // ç•¶å‰ç·´ç¿’ç”¨çš„é£Ÿç‰©æ•¸é‡ï¼ˆç”±æ»‘ç«¿æ§åˆ¶ï¼‰
        let totalPlates = 4; // ç•¶å‰ç·´ç¿’ç”¨çš„ç›¤å­æ•¸é‡ï¼ˆç”±æ»‘ç«¿æ§åˆ¶ï¼‰
        let foodItems = [];
        let plates = [];
        let foodOnPlates = {}; // è¨˜éŒ„æ¯å€‹ç›¤å­ä¸Šçš„é£Ÿç‰©ID
        let allFoodItems = {}; // è¨˜éŒ„æ‰€æœ‰é£Ÿç‰©ç‰©ä»¶
        
        // DOM å…ƒç´ 
        const gameArea = document.getElementById('game-area');
        const foodSlider = document.getElementById('food-slider');
        const plateSlider = document.getElementById('plate-slider');
        const foodCountValue = document.getElementById('food-count-value');
        const plateCountValue = document.getElementById('plate-count-value');
        const problemEquation = document.getElementById('problem-equation');
        const problemHint = document.getElementById('problem-hint');
        const totalFoodEl = document.getElementById('total-food');
        const totalPlatesEl = document.getElementById('total-plates');
        const remainingFoodEl = document.getElementById('remaining-food');
        const foodOnPlatesEl = document.getElementById('food-on-plates');
        const feedbackEl = document.getElementById('feedback');
        const checkBtn = document.getElementById('check-btn');
        const resetBtn = document.getElementById('reset-btn');
        const newProblemBtn = document.getElementById('new-problem-btn');
        const answerInput = document.getElementById('answer-input');
        const foodGrid = document.getElementById('food-grid');
        const plateGrid = document.getElementById('plate-grid');
        const problemDividendEl = document.getElementById('problem-dividend');
        const problemDivisorEl = document.getElementById('problem-divisor');
        
        // é£Ÿç‰©è¡¨æƒ…ç¬¦è™Ÿ
        const foodEmojis = ['ğŸ•', 'ğŸ”', 'ğŸŒ­', 'ğŸ¥ª', 'ğŸŸ', 'ğŸ—', 'ğŸ¥¨', 'ğŸ¦', 'ğŸ©', 'ğŸª', 'ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸ“', 'ğŸ¥‘', 'ğŸ¥¦', 'ğŸ¥•', 'ğŸŒ½', 'ğŸ§€', 'ğŸ¥š'];
        
        // ç›¤å­è¡¨æƒ…ç¬¦è™Ÿ
        const plateEmojis = ['ğŸ½ï¸', 'ğŸ¥˜', 'ğŸ›', 'ğŸœ', 'ğŸ²', 'ğŸ¥£', 'ğŸ´', 'ğŸ¥„', 'ğŸ”¸', 'ğŸ”¹'];
        
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            // ç”Ÿæˆç¬¬ä¸€å€‹éš¨æ©Ÿå•é¡Œ
            generateRandomProblem();
            
            // æ·»åŠ äº‹ä»¶ç›£è½å™¨
            foodSlider.addEventListener('input', handleFoodSliderChange);
            plateSlider.addEventListener('input', handlePlateSliderChange);
            checkBtn.addEventListener('click', checkAnswer);
            resetBtn.addEventListener('click', resetGame);
            newProblemBtn.addEventListener('click', generateRandomProblem);
            answerInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
            
            // åˆå§‹åŒ–éŠæˆ²å…ƒç´ 
            createGameElements();
            updateStats();
        }
        
        // ç”Ÿæˆéš¨æ©Ÿå•é¡Œ
        function generateRandomProblem() {
            let divisor, dividend, multiplier, maxMultiplier;
            let attempts = 0;
            const maxAttempts = 100;
            
            do {
                // éš¨æ©Ÿç”Ÿæˆé™¤æ•¸ (2-9ï¼Œé¿å…é™¤æ•¸ç‚º1)
                divisor = Math.floor(Math.random() * 8) + 2; // 2-9
                
                // ç”Ÿæˆèƒ½è¢«é™¤æ•¸æ•´é™¤çš„è¢«é™¤æ•¸ (1-20ä»¥å…§)
                maxMultiplier = Math.floor(20 / divisor);
                
                // ç¢ºä¿æœ‰è‡³å°‘ä¸€å€‹å€æ•¸å¯ç”¨
                if (maxMultiplier < 1) {
                    continue;
                }
                
                multiplier = Math.floor(Math.random() * maxMultiplier) + 1;
                dividend = divisor * multiplier;
                
                attempts++;
                
                // é¿å…è¢«é™¤æ•¸å’Œé™¤æ•¸ç›¸åŒï¼Œä¸”ç¢ºä¿è¢«é™¤æ•¸å¤§æ–¼é™¤æ•¸
            } while ((dividend === divisor || dividend <= divisor) && attempts < maxAttempts);
            
            // å¦‚æœç¶“éå¤šæ¬¡å˜—è©¦ä»ç„¶ä¸ç¬¦åˆæ¢ä»¶ï¼Œä½¿ç”¨é»˜èªå€¼
            if (attempts >= maxAttempts || dividend === divisor) {
                // ä½¿ç”¨ä¸€äº›é è¨­çš„å¥½å•é¡Œ
                const defaultProblems = [
                    {dividend: 12, divisor: 4, answer: 3},
                    {dividend: 15, divisor: 5, answer: 3},
                    {dividend: 18, divisor: 6, answer: 3},
                    {dividend: 20, divisor: 5, answer: 4},
                    {dividend: 16, divisor: 8, answer: 2},
                    {dividend: 14, divisor: 7, answer: 2},
                    {dividend: 9, divisor: 3, answer: 3},
                    {dividend: 10, divisor: 2, answer: 5},
                    {dividend: 8, divisor: 4, answer: 2},
                    {dividend: 6, divisor: 2, answer: 3}
                ];
                
                const randomIndex = Math.floor(Math.random() * defaultProblems.length);
                currentProblem = defaultProblems[randomIndex];
            } else {
                // è¨ˆç®—ç­”æ¡ˆ
                const answer = dividend / divisor;
                
                // æ›´æ–°å•é¡Œ
                currentProblem = { dividend, divisor, answer };
            }
            
            // æ›´æ–°å•é¡Œé¡¯ç¤º
            updateProblemDisplay();
            
            // é‡ç½®ç­”æ¡ˆè¼¸å…¥
            answerInput.value = '';
            
            // é‡ç½®éŠæˆ²
            resetDistribution();
            
            clearFeedback();
        }
        
        // æ›´æ–°å•é¡Œé¡¯ç¤º
        function updateProblemDisplay() {
            problemEquation.textContent = `${currentProblem.dividend} Ã· ${currentProblem.divisor} = ?`;
            problemHint.textContent = `å°‡ ${currentProblem.dividend} å€‹é£Ÿç‰©å¹³å‡åˆ†é…åˆ° ${currentProblem.divisor} å€‹ç›¤å­ä¸­ï¼Œæ¯å€‹ç›¤å­æ‡‰è©²æœ‰å¹¾å€‹é£Ÿç‰©ï¼Ÿ`;
            
            // æ›´æ–°å•é¡Œè³‡è¨Šå€åŸŸ
            problemDividendEl.textContent = currentProblem.dividend;
            problemDivisorEl.textContent = currentProblem.divisor;
        }
        
        // è™•ç†é£Ÿç‰©æ»‘ç«¿è®ŠåŒ–
        function handleFoodSliderChange() {
            totalFood = parseInt(foodSlider.value);
            foodCountValue.textContent = totalFood;
            
            // é‡æ–°å‰µå»ºéŠæˆ²å…ƒç´ 
            createGameElements();
            updateStats();
            clearFeedback();
        }
        
        // è™•ç†ç›¤å­æ»‘ç«¿è®ŠåŒ–
        function handlePlateSliderChange() {
            totalPlates = parseInt(plateSlider.value);
            plateCountValue.textContent = totalPlates;
            
            // åˆå§‹åŒ–ç›¤å­é£Ÿç‰©è¨ˆæ•¸
            foodOnPlates = {};
            for (let i = 0; i < totalPlates; i++) {
                foodOnPlates[i] = [];
            }
            
            // é‡æ–°å‰µå»ºéŠæˆ²å…ƒç´ 
            createGameElements();
            updateStats();
            clearFeedback();
        }
        
        // å‰µå»ºéŠæˆ²å…ƒç´ ï¼ˆé£Ÿç‰©å’Œç›¤å­ï¼‰
        function createGameElements() {
            // æ¸…é™¤å®¹å™¨
            foodGrid.innerHTML = '';
            plateGrid.innerHTML = '';
            foodItems = [];
            plates = [];
            allFoodItems = {};
            
            // å‰µå»ºé£Ÿç‰©ç¶²æ ¼ (5x4 = 20å€‹ä½ç½®)
            for (let i = 0; i < 20; i++) {
                const cell = document.createElement('div');
                
                if (i < totalFood) {
                    // å‰µå»ºé£Ÿç‰©
                    const food = document.createElement('div');
                    food.className = 'food-item';
                    food.innerHTML = foodEmojis[i % foodEmojis.length];
                    food.dataset.foodId = i;
                    food.dataset.inPlate = 'false';
                    
                    // æ·»åŠ æ‹–å‹•åŠŸèƒ½
                    makeDraggable(food);
                    
                    cell.appendChild(food);
                    
                    const foodObj = {
                        element: food,
                        id: i,
                        plateId: null,
                        inPlate: false
                    };
                    
                    foodItems.push(foodObj);
                    allFoodItems[i] = foodObj;
                } else {
                    // å‰µå»ºç©ºä½ç½®
                    cell.className = 'empty-cell';
                }
                
                foodGrid.appendChild(cell);
            }
            
            // å‰µå»ºç›¤å­ç¶²æ ¼ (5x4 = 20å€‹ä½ç½®ï¼Œè¶³å¤ é¡¯ç¤º10å€‹ç›¤å­)
            for (let i = 0; i < 20; i++) {
                const cell = document.createElement('div');
                
                if (i < totalPlates) {
                    // å‰µå»ºç›¤å­
                    const plate = document.createElement('div');
                    plate.className = 'plate';
                    plate.dataset.plateId = i;
                    
                    plate.innerHTML = `
                        <div class="plate-icon">${plateEmojis[i % plateEmojis.length]}</div>
                        <div class="plate-label">ç›¤å­ ${i + 1}</div>
                        <div class="plate-count" id="plate-count-${i}">0</div>
                        <div class="plate-food-items" id="plate-food-items-${i}"></div>
                    `;
                    
                    // è¨­ç½®ç›¤å­ç‚ºå¯æ”¾ç½®å€åŸŸ
                    plate.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        plate.style.borderColor = '#55efc4';
                        plate.style.boxShadow = '0 0 15px rgba(85, 239, 196, 0.5)';
                    });
                    
                    plate.addEventListener('dragleave', () => {
                        plate.style.borderColor = 'var(--secondary)';
                        plate.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.1)';
                    });
                    
                    plate.addEventListener('drop', (e) => {
                        e.preventDefault();
                        plate.style.borderColor = 'var(--secondary)';
                        plate.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.1)';
                        
                        const foodId = e.dataTransfer.getData('text/plain');
                        if (foodId) {
                            placeFoodOnPlate(parseInt(foodId), i);
                        }
                    });
                    
                    cell.appendChild(plate);
                    
                    plates.push({
                        element: plate,
                        id: i
                    });
                    
                    // åˆå§‹åŒ–ç›¤å­é£Ÿç‰©è¨ˆæ•¸
                    if (!foodOnPlates[i]) {
                        foodOnPlates[i] = [];
                    }
                } else {
                    // å‰µå»ºç©ºä½ç½®
                    cell.className = 'empty-plate-cell';
                }
                
                plateGrid.appendChild(cell);
            }
        }
        
        // ä½¿å…ƒç´ å¯æ‹–å‹•
        function makeDraggable(element) {
            element.setAttribute('draggable', 'true');
            
            element.addEventListener('dragstart', (e) => {
                // åªå…è¨±åœ¨é£Ÿç‰©å€çš„é£Ÿç‰©è¢«æ‹–å‹•
                if (element.dataset.inPlate === 'true') {
                    e.preventDefault();
                    return;
                }
                
                element.classList.add('dragging');
                e.dataTransfer.setData('text/plain', element.dataset.foodId);
                e.dataTransfer.effectAllowed = 'move';
            });
            
            element.addEventListener('dragend', () => {
                element.classList.remove('dragging');
            });
        }
        
        // å°‡é£Ÿç‰©æ”¾åœ¨ç›¤å­ä¸Š
        function placeFoodOnPlate(foodId, plateId) {
            const foodItem = allFoodItems[foodId];
            if (!foodItem || foodItem.inPlate) return;
            
            const foodElement = foodItem.element;
            const plateFoodItemsContainer = document.getElementById(`plate-food-items-${plateId}`);
            
            // å°‡é£Ÿç‰©æ·»åŠ åˆ°ç›¤å­
            foodItem.plateId = plateId;
            foodItem.inPlate = true;
            foodOnPlates[plateId].push(foodId);
            
            // æ›´æ–°é£Ÿç‰©å…ƒç´ å±¬æ€§
            foodElement.dataset.inPlate = 'true';
            foodElement.dataset.plateId = plateId;
            
            // å¾é£Ÿç‰©å®¹å™¨ä¸­ç§»é™¤é£Ÿç‰©ï¼ˆè¦–è¦ºä¸Šæ¶ˆå¤±ï¼‰
            foodElement.style.display = 'none';
            
            // å‰µå»ºç›¤å­ä¸Šçš„é£Ÿç‰©é¡¯ç¤º
            const plateFoodElement = document.createElement('div');
            plateFoodElement.className = 'food-item in-plate';
            plateFoodElement.innerHTML = foodElement.innerHTML;
            plateFoodElement.dataset.foodId = foodId;
            plateFoodElement.dataset.inPlate = 'true';
            
            // æ·»åŠ è¿”å›åŠŸèƒ½ï¼ˆé›™æ“Šè¿”å›é£Ÿç‰©å€ï¼‰
            plateFoodElement.addEventListener('dblclick', () => {
                returnFoodToContainer(foodId);
            });
            
            plateFoodItemsContainer.appendChild(plateFoodElement);
            
            // æ›´æ–°ç›¤å­è¨ˆæ•¸å’Œçµ±è¨ˆ
            updatePlateCount(plateId);
            updateStats();
        }
        
        // å°‡é£Ÿç‰©è¿”å›é£Ÿç‰©å®¹å™¨
        function returnFoodToContainer(foodId) {
            const foodItem = allFoodItems[foodId];
            if (!foodItem || !foodItem.inPlate) return;
            
            const plateId = foodItem.plateId;
            const plateFoodItemsContainer = document.getElementById(`plate-food-items-${plateId}`);
            
            // å¾ç›¤å­ä¸­ç§»é™¤
            const index = foodOnPlates[plateId].indexOf(foodId);
            if (index > -1) {
                foodOnPlates[plateId].splice(index, 1);
            }
            
            // ç§»é™¤ç›¤å­ä¸Šçš„é£Ÿç‰©é¡¯ç¤º
            const plateFoodElement = plateFoodItemsContainer.querySelector(`[data-food-id="${foodId}"]`);
            if (plateFoodElement) {
                plateFoodElement.remove();
            }
            
            // æ›´æ–°é£Ÿç‰©ç‹€æ…‹
            foodItem.plateId = null;
            foodItem.inPlate = false;
            foodItem.element.dataset.inPlate = 'false';
            delete foodItem.element.dataset.plateId;
            
            // é‡æ–°é¡¯ç¤ºé£Ÿç‰©åœ¨é£Ÿç‰©å®¹å™¨ä¸­
            foodItem.element.style.display = 'block';
            
            // æ›´æ–°ç›¤å­è¨ˆæ•¸å’Œçµ±è¨ˆ
            updatePlateCount(plateId);
            updateStats();
        }
        
        // æ›´æ–°ç›¤å­è¨ˆæ•¸é¡¯ç¤º
        function updatePlateCount(plateId) {
            const count = foodOnPlates[plateId] ? foodOnPlates[plateId].length : 0;
            const plateCountEl = document.getElementById(`plate-count-${plateId}`);
            if (plateCountEl) {
                plateCountEl.textContent = count;
            }
        }
        
        // æ›´æ–°çµ±è¨ˆè³‡è¨Š
        function updateStats() {
            totalFoodEl.textContent = totalFood;
            totalPlatesEl.textContent = totalPlates;
            
            // è¨ˆç®—å·²åˆ†é…çš„é£Ÿç‰©ç¸½æ•¸
            let totalFoodOnPlates = 0;
            for (let i = 0; i < totalPlates; i++) {
                if (foodOnPlates[i]) {
                    totalFoodOnPlates += foodOnPlates[i].length;
                }
            }
            
            foodOnPlatesEl.textContent = totalFoodOnPlates;
            remainingFoodEl.textContent = totalFood - totalFoodOnPlates;
        }
        
        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const userAnswer = parseInt(answerInput.value);
            
            if (isNaN(userAnswer)) {
                showFeedback('è«‹è¼¸å…¥ä¸€å€‹æ•¸å­—ç­”æ¡ˆï¼', 'incorrect');
                return;
            }
            
            if (userAnswer === currentProblem.answer) {
                showFeedback('å¤ªæ£’äº†ï¼ç­”æ¡ˆæ­£ç¢ºï¼', 'correct');
            } else {
                showFeedback('ç­”æ¡ˆä¸å°ï¼Œå†è©¦è©¦çœ‹ï¼', 'incorrect');
                // ä¸å†æç¤ºæ­£ç¢ºç­”æ¡ˆ
            }
        }
        
        // é‡ç½®åˆ†é…ï¼ˆåªé‡ç½®é£Ÿç‰©åˆ†é…ï¼Œä¸æ”¹è®Šå•é¡Œå’Œæ»‘ç«¿ï¼‰
        function resetDistribution() {
            // å°‡æ‰€æœ‰é£Ÿç‰©è¿”å›é£Ÿç‰©å®¹å™¨
            for (const foodId in allFoodItems) {
                const foodItem = allFoodItems[foodId];
                if (foodItem.inPlate) {
                    returnFoodToContainer(parseInt(foodId));
                }
            }
            
            // é‡ç½®ç›¤å­é£Ÿç‰©è¨ˆæ•¸
            foodOnPlates = {};
            for (let i = 0; i < totalPlates; i++) {
                foodOnPlates[i] = [];
                updatePlateCount(i);
            }
            
            // é‡ç½®ç­”æ¡ˆè¼¸å…¥
            answerInput.value = '';
            
            updateStats();
            clearFeedback();
        }
        
        // é‡ç½®æ•´å€‹éŠæˆ²ï¼ˆåŒ…æ‹¬æ»‘ç«¿ï¼‰
        function resetGame() {
            // é‡ç½®æ»‘ç«¿åˆ°å•é¡Œçš„å€¼
            totalFood = currentProblem.dividend;
            totalPlates = currentProblem.divisor;
            
            foodSlider.value = totalFood;
            plateSlider.value = totalPlates;
            foodCountValue.textContent = totalFood;
            plateCountValue.textContent = totalPlates;
            
            // é‡æ–°å‰µå»ºéŠæˆ²å…ƒç´ 
            createGameElements();
            updateStats();
            clearFeedback();
            
            // è¦–è¦ºåé¥‹
            resetBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                resetBtn.style.transform = 'scale(1)';
            }, 150);
        }
        
        // é¡¯ç¤ºåé¥‹è¨Šæ¯
        function showFeedback(message, type) {
            feedbackEl.textContent = message;
            feedbackEl.className = `feedback ${type}`;
            
            // 5ç§’å¾Œæ¸…é™¤åé¥‹
            setTimeout(clearFeedback, 5000);
        }
        
        // æ¸…é™¤åé¥‹è¨Šæ¯
        function clearFeedback() {
            feedbackEl.textContent = '';
            feedbackEl.className = 'feedback';
        }
        
        // åˆå§‹åŒ–éŠæˆ²
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
